#!/usr/bin/env bash
set -euo pipefail

SITE_DIR="$(cd "$(dirname "$0")" && pwd)"
REPO_DIR="$(dirname "$SITE_DIR")"
SPEC_SOURCE="$REPO_DIR/SPEC.md"
SPEC_DEST="$SITE_DIR/content/spec/_index.md"

# Ensure content/spec/ directory exists
mkdir -p "$SITE_DIR/content/spec"

# Prepend front matter to SPEC.md and write to content directory
cat > "$SPEC_DEST" <<'FRONTMATTER'
---
title: "Agent-Friendly Documentation Spec"
description: "A specification defining 21 checks across 8 categories for evaluating how well documentation sites serve coding agents."
showTableOfContents: true
---

FRONTMATTER

# Strip the first H1 header line (duplicates the page title from front matter)
tail -n +2 "$SPEC_SOURCE" >> "$SPEC_DEST"

echo "Generated $SPEC_DEST"

# Run Hugo, passing through any arguments (e.g., "server")
cd "$SITE_DIR"
hugo "$@"
